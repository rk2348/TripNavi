<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ—…ã®ãƒ—ãƒ©ãƒ³æ•´ç†ãƒ¡ãƒ¢</title>
  <style>
    :root {
      --primary-color: #4A90E2;
      --bg-color: #F4F7F6;
      --card-bg: #FFFFFF;
      --text-color: #333333;
      --sync-color: #27AE60;
    }
    body {
      font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      line-height: 1.6;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
    }
    h1 {
      text-align: center;
      color: var(--primary-color);
      margin-bottom: 30px;
    }
    .card {
      background: var(--card-bg);
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    }
    .card h2 {
      margin-top: 0;
      border-bottom: 2px solid var(--primary-color);
      padding-bottom: 10px;
      font-size: 1.2rem;
      color: var(--primary-color);
    }
    .sync-card {
      background-color: #E8F5E9;
      border: 2px solid var(--sync-color);
    }
    .sync-card h2 {
      color: var(--sync-color);
      border-bottom-color: var(--sync-color);
    }
    .form-group {
      margin-bottom: 15px;
    }
    label {
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
      font-size: 0.9rem;
    }
    input[type="text"],
    input[type="number"],
    input[type="date"],
    input[type="time"],
    textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box;
      font-family: inherit;
    }
    textarea {
      resize: vertical;
      min-height: 100px;
    }
    .row {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }
    .row .form-group {
      flex: 1;
      min-width: 200px;
    }
    
    /* æŒã¡ç‰©ãƒªã‚¹ãƒˆç”¨ãƒ‡ã‚¶ã‚¤ãƒ³ */
    .checklist-group {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 10px;
    }
    .checklist-item {
      display: flex;
      align-items: center;
      font-size: 0.95rem;
    }
    .checklist-item input[type="checkbox"] {
      width: 18px;
      height: 18px;
      margin-right: 8px;
      cursor: pointer;
    }
    .checklist-item input[type="text"] {
      padding: 5px;
      margin-left: 5px;
      width: calc(100% - 30px);
    }

    /* è²»ç”¨è¨ˆç®—ç”¨ãƒ‡ã‚¶ã‚¤ãƒ³ */
    .total-box {
      background-color: #E8F4FD;
      padding: 15px;
      border-radius: 5px;
      text-align: right;
      font-size: 1.2rem;
      font-weight: bold;
      color: var(--primary-color);
    }
    .total-box input {
      background: transparent;
      border: none;
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--primary-color);
      text-align: right;
      width: 150px;
      padding: 0;
    }

    .buttons {
      text-align: center;
      margin-top: 30px;
    }
    button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: bold;
      margin: 5px;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #357ABD;
    }
    .btn-sync {
      background-color: var(--sync-color);
      margin-top: 25px;
      width: 100%;
    }
    .btn-sync:hover {
      background-color: #219653;
    }
    .btn-clear {
      background-color: #E74C3C;
    }
    .btn-clear:hover {
      background-color: #C0392B;
    }
    .sync-status {
      font-size: 0.9rem;
      font-weight: bold;
      color: var(--sync-color);
      text-align: center;
      margin-top: 10px;
      display: none;
    }
    
    /* å°åˆ·æ™‚ã®è¨­å®š */
    @media print {
      body { background-color: white; padding: 0; }
      .card { box-shadow: none; border: 1px solid #ddd; page-break-inside: avoid; }
      .sync-card, .buttons { display: none; }
      input, textarea { border: none; background: transparent; resize: none; }
      input[type="number"] { -moz-appearance: textfield; }
      input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>âœˆï¸ æ—…ã®ãƒ—ãƒ©ãƒ³æ•´ç†ãƒ¡ãƒ¢</h1>

    <div class="card sync-card">
      <h2>ğŸ”„ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å…±æœ‰</h2>
      <p style="font-size: 0.9rem; margin-top: 0;">ãŠäº’ã„ã«åŒã˜ã€Œå…±æœ‰IDã€ã‚’å…¥åŠ›ã—ã¦åŒæœŸã‚’é–‹å§‹ã™ã‚‹ã¨ã€ãƒ—ãƒ©ãƒ³ã‚’å…±åŒç·¨é›†ã§ãã¾ã™ã€‚ï¼ˆâ€»æŒã¡ç‰©ãƒªã‚¹ãƒˆã¯å€‹äººã®ç«¯æœ«ã«ã®ã¿ä¿å­˜ã•ã‚Œã€å…±æœ‰ã•ã‚Œã¾ã›ã‚“ï¼‰</p>
      <div class="row">
        <div class="form-group" style="flex: 2;">
          <label for="share-id">å…±æœ‰IDï¼ˆãŠå¥½ããªè‹±æ•°å­—ã‚’æ±ºã‚ã¦ãã ã•ã„ï¼‰</label>
          <input type="text" id="share-id" placeholder="ä¾‹ï¼štrip2026-osaka">
        </div>
        <div class="form-group" style="flex: 1;">
          <button id="btn-start-sync" class="btn-sync">åŒæœŸã‚’é–‹å§‹ã™ã‚‹</button>
        </div>
      </div>
      <div id="sync-status-text" class="sync-status">âœ… ç¾åœ¨ã€Œ<span id="display-sync-id"></span>ã€ã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸä¸­ã§ã™</div>
    </div>

    <div class="card">
      <h2>ğŸ“ åŸºæœ¬æƒ…å ±</h2>
      <div class="form-group">
        <label for="trip-title">æ—…è¡Œã®ã‚¿ã‚¤ãƒˆãƒ«ãƒ»ç›®çš„åœ°</label>
        <input type="text" id="trip-title" class="shared-data" placeholder="ä¾‹ï¼šç§‹ã®äº¬éƒ½ 2æ³Š3æ—¥">
      </div>
      <div class="row">
        <div class="form-group">
          <label for="date-start">å‡ºç™ºæ—¥</label>
          <input type="date" id="date-start" class="shared-data">
        </div>
        <div class="form-group">
          <label for="date-end">å¸°å®…æ—¥</label>
          <input type="date" id="date-end" class="shared-data">
        </div>
      </div>
    </div>

    <div class="card">
      <h2>ğŸšŒ äº¤é€šæ‰‹æ®µï¼ˆå¤œè¡Œãƒã‚¹ãƒ»æ–°å¹¹ç·šãªã©ï¼‰</h2>
      <div class="row">
        <div class="form-group">
          <label for="bus-depart-time">è¡Œãï¼šå‡ºç™ºæ™‚é–“ãƒ»ä¹—è»Šå ´æ‰€</label>
          <input type="text" id="bus-depart-time" class="shared-data" placeholder="ä¾‹ï¼š23:15 ãƒã‚¹ã‚¿æ–°å®¿">
        </div>
        <div class="form-group">
          <label for="bus-arrive-time">è¡Œãï¼šåˆ°ç€æ™‚é–“ãƒ»é™è»Šå ´æ‰€</label>
          <input type="text" id="bus-arrive-time" class="shared-data" placeholder="ä¾‹ï¼š06:30 äº¬éƒ½é§…å…«æ¡å£">
        </div>
      </div>
      <div class="row">
        <div class="form-group">
          <label for="bus-return-time">å¸°ã‚Šï¼šå‡ºç™ºæ™‚é–“ãƒ»ä¹—è»Šå ´æ‰€</label>
          <input type="text" id="bus-return-time" class="shared-data" placeholder="ä¾‹ï¼š23:30 äº¬éƒ½é§…">
        </div>
        <div class="form-group">
          <label for="bus-return-arrive">å¸°ã‚Šï¼šåˆ°ç€æ™‚é–“ãƒ»é™è»Šå ´æ‰€</label>
          <input type="text" id="bus-return-arrive" class="shared-data" placeholder="ä¾‹ï¼š06:45 ãƒã‚¹ã‚¿æ–°å®¿">
        </div>
      </div>
      <div class="form-group">
        <label for="bus-url">äºˆç´„ã‚µã‚¤ãƒˆã®URLãƒ»äºˆç´„ç•ªå·</label>
        <input type="text" id="bus-url" class="shared-data" placeholder="URLã‚„ã€äºˆç´„ç•ªå·123456 ãªã©">
      </div>
    </div>

    <div class="card">
      <h2>ğŸ¨ å®¿æ³Šå…ˆ</h2>
      <div class="form-group">
        <label for="hotel-name">ãƒ›ãƒ†ãƒ«ãƒ»å®¿ã®åå‰</label>
        <input type="text" id="hotel-name" class="shared-data" placeholder="ä¾‹ï¼šãƒ›ãƒ†ãƒ«ã€‡ã€‡äº¬éƒ½">
      </div>
      <div class="row">
        <div class="form-group">
          <label for="check-in">ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³æ™‚é–“</label>
          <input type="time" id="check-in" class="shared-data">
        </div>
        <div class="form-group">
          <label for="check-out">ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆæ™‚é–“</label>
          <input type="time" id="check-out" class="shared-data">
        </div>
      </div>
      <div class="form-group">
        <label for="hotel-address">ä½æ‰€ãƒ»ã‚¢ã‚¯ã‚»ã‚¹</label>
        <input type="text" id="hotel-address" class="shared-data" placeholder="ä¾‹ï¼šäº¬éƒ½é§…å¾’æ­©5åˆ†ï¼ˆäº¬éƒ½åºœäº¬éƒ½å¸‚ã€œï¼‰">
      </div>
      <div class="form-group">
        <label for="hotel-url">äºˆç´„ã‚µã‚¤ãƒˆã®URLãƒ»äºˆç´„ç•ªå·</label>
        <input type="text" id="hotel-url" class="shared-data" placeholder="URLã‚„äºˆç´„ç•ªå·ã‚’ãƒ¡ãƒ¢">
      </div>
    </div>

    <div class="card">
      <h2>ğŸ’´ è²»ç”¨ãƒ¡ãƒ¢ï¼ˆæ¦‚ç®—ï¼‰</h2>
      <div class="row">
        <div class="form-group">
          <label for="cost-transport">äº¤é€šè²»ï¼ˆå††ï¼‰</label>
          <input type="number" id="cost-transport" class="cost-input shared-data" placeholder="0" min="0">
        </div>
        <div class="form-group">
          <label for="cost-hotel">å®¿æ³Šè²»ï¼ˆå††ï¼‰</label>
          <input type="number" id="cost-hotel" class="cost-input shared-data" placeholder="0" min="0">
        </div>
      </div>
      <div class="row">
        <div class="form-group">
          <label for="cost-food">é£Ÿè²»ï¼ˆå††ï¼‰</label>
          <input type="number" id="cost-food" class="cost-input shared-data" placeholder="0" min="0">
        </div>
        <div class="form-group">
          <label for="cost-activity">è¦³å…‰ãƒ»ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ä»£ï¼ˆå††ï¼‰</label>
          <input type="number" id="cost-activity" class="cost-input shared-data" placeholder="0" min="0">
        </div>
        <div class="form-group">
          <label for="cost-other">ãŠåœŸç”£ãƒ»ãã®ä»–ï¼ˆå††ï¼‰</label>
          <input type="number" id="cost-other" class="cost-input shared-data" placeholder="0" min="0">
        </div>
      </div>
      <div class="total-box">
        åˆè¨ˆï¼š <input type="text" id="cost-total" readonly value="0"> å††
      </div>
    </div>

    <div class="card">
      <h2>ğŸ’ æŒã¡ç‰©ãƒªã‚¹ãƒˆï¼ˆâ€»è‡ªåˆ†å°‚ç”¨ãƒ¡ãƒ¢ï¼‰</h2>
      <div class="checklist-group">
        <label class="checklist-item"><input type="checkbox" id="chk-1" class="private-data"> ç¾é‡‘ãƒ»ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ãƒ»èº«åˆ†è¨¼</label>
        <label class="checklist-item"><input type="checkbox" id="chk-2" class="private-data"> ã‚¹ãƒãƒ›ãƒ»å……é›»å™¨ãƒ»ãƒ¢ãƒã‚¤ãƒ«ãƒãƒƒãƒ†ãƒªãƒ¼</label>
        <label class="checklist-item"><input type="checkbox" id="chk-3" class="private-data"> ç€æ›¿ãˆãƒ»ä¸‹ç€ãƒ»é´ä¸‹</label>
        <label class="checklist-item"><input type="checkbox" id="chk-4" class="private-data"> æ´—é¢ç”¨å…·ãƒ»ã‚¹ã‚­ãƒ³ã‚±ã‚¢ãƒ»åŒ–ç²§å“</label>
        <label class="checklist-item"><input type="checkbox" id="chk-5" class="private-data"> å¸¸å‚™è–¬ãƒ»ã‚³ãƒ³ã‚¿ã‚¯ãƒˆãƒ¬ãƒ³ã‚º</label>
        <label class="checklist-item"><input type="checkbox" id="chk-6" class="private-data"> ãƒ‘ã‚¸ãƒ£ãƒãƒ»ãƒ«ãƒ¼ãƒ ã‚¦ã‚§ã‚¢</label>
        <label class="checklist-item"><input type="checkbox" id="chk-7" class="private-data"> æŠ˜ã‚ŠãŸãŸã¿å‚˜ãƒ»é›¨å…·</label>
        <label class="checklist-item"><input type="checkbox" id="chk-8" class="private-data"> ãƒ“ãƒ‹ãƒ¼ãƒ«è¢‹ï¼ˆæ´—æ¿¯ç‰©ãƒ»ã‚´ãƒŸç”¨ï¼‰</label>
        
        <div class="checklist-item"><input type="checkbox" id="chk-free-1" class="private-data"><input type="text" id="txt-free-1" class="private-data" placeholder="è‡ªç”±ã«å…¥åŠ›"></div>
        <div class="checklist-item"><input type="checkbox" id="chk-free-2" class="private-data"><input type="text" id="txt-free-2" class="private-data" placeholder="è‡ªç”±ã«å…¥åŠ›"></div>
        <div class="checklist-item"><input type="checkbox" id="chk-free-3" class="private-data"><input type="text" id="txt-free-3" class="private-data" placeholder="è‡ªç”±ã«å…¥åŠ›"></div>
        <div class="checklist-item"><input type="checkbox" id="chk-free-4" class="private-data"><input type="text" id="txt-free-4" class="private-data" placeholder="è‡ªç”±ã«å…¥åŠ›"></div>
      </div>
    </div>

    <div class="card">
      <h2>ğŸ—ºï¸ è¡ŒããŸã„å ´æ‰€ãƒ»ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ»ãƒ¡ãƒ¢</h2>
      <div class="form-group">
        <label for="schedule-memo">è‡ªç”±ã«æ›¸ãè¾¼ã‚ã‚‹ãƒ¡ãƒ¢å¸³ï¼ˆãŠåº—ã®URLã‚„é£Ÿã¹ãŸã„ã‚‚ã®ãªã©ï¼‰</label>
        <textarea id="schedule-memo" class="shared-data" placeholder="ãƒ»1æ—¥ç›®æ˜¼ï¼šã€‡ã€‡é£Ÿå ‚ã§ãƒ©ãƒ³ãƒï¼ˆURLï¼‰&#10;ãƒ»è¡ŒããŸã„ã‚«ãƒ•ã‚§ï¼šã€‡ã€‡ã‚³ãƒ¼ãƒ’ãƒ¼&#10;ãƒ»ãŠåœŸç”£ã«ã€‡ã€‡ã‚’è²·ã†"></textarea>
      </div>
    </div>

    <div class="buttons">
      <button onclick="window.print()">ğŸ–¨ï¸ PDFã¨ã—ã¦ä¿å­˜ / å°åˆ·</button>
      <button class="btn-clear" id="btn-clear-data">ğŸ—‘ï¸ ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getDatabase, ref, onValue, update, remove } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";

    // ã„ãŸã ã„ãŸæƒ…å ± ï¼‹ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹URLã‚’è¿½åŠ ã—ãŸè¨­å®š
    const firebaseConfig = {
      apiKey: "AIzaSyCQ5Dig1lRAz3GihBnWFJBgHTLD864QWpg",
      authDomain: "tripnavi-6363a.firebaseapp.com",
      databaseURL: "https://tripnavi-6363a-default-rtdb.firebaseio.com",
      projectId: "tripnavi-6363a",
      storageBucket: "tripnavi-6363a.firebasestorage.app",
      messagingSenderId: "946828759773",
      appId: "1:946828759773:web:990ff142a2744c55b24134"
    };

    let app, db;
    let currentSyncId = null;
    let isSyncing = false;

    const sharedInputs = document.querySelectorAll('.shared-data');
    const privateInputs = document.querySelectorAll('.private-data');
    const allInputs = document.querySelectorAll('input:not(#share-id), textarea');

    function calculateTotal() {
      let total = 0;
      document.querySelectorAll('.cost-input').forEach(input => {
        const val = parseInt(input.value, 10);
        if (!isNaN(val)) {
          total += val;
        }
      });
      document.getElementById('cost-total').value = total.toLocaleString();
    }

    window.addEventListener('DOMContentLoaded', () => {
      allInputs.forEach(input => {
        const savedData = localStorage.getItem(input.id);
        if (savedData !== null) {
          if (input.type === 'checkbox') {
            input.checked = (savedData === 'true');
          } else {
            input.value = savedData;
          }
        }
      });
      calculateTotal();
    });

    allInputs.forEach(input => {
      input.addEventListener('input', () => {
        if (input.type === 'checkbox') {
          localStorage.setItem(input.id, input.checked);
        } else {
          localStorage.setItem(input.id, input.value);
        }

        if (input.classList.contains('cost-input')) calculateTotal();

        if (isSyncing && input.classList.contains('shared-data')) {
          const tripRef = ref(db, 'trips/' + currentSyncId);
          update(tripRef, { [input.id]: input.value });
        }
      });
    });

    document.getElementById('btn-start-sync').addEventListener('click', () => {
      const shareId = document.getElementById('share-id').value.trim();
      if (!shareId) {
        alert("å…±æœ‰IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        return;
      }

      if (!app) {
        try {
          app = initializeApp(firebaseConfig);
          db = getDatabase(app);
        } catch (error) {
          alert("Firebaseã®æ¥ç¶šã‚¨ãƒ©ãƒ¼ã§ã™ã€‚è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
          console.error(error);
          return;
        }
      }

      currentSyncId = shareId;
      isSyncing = true;
      
      document.getElementById('display-sync-id').textContent = shareId;
      document.getElementById('sync-status-text').style.display = 'block';
      
      const tripRef = ref(db, 'trips/' + currentSyncId);
      const initialData = {};
      sharedInputs.forEach(input => {
        if (input.value) initialData[input.id] = input.value;
      });
      if (Object.keys(initialData).length > 0) {
        update(tripRef, initialData);
      }

      onValue(tripRef, (snapshot) => {
        const data = snapshot.val();
        if (data) {
          sharedInputs.forEach(input => {
            if (data[input.id] !== undefined && document.activeElement !== input) {
              input.value = data[input.id];
              localStorage.setItem(input.id, input.value);
            }
          });
          calculateTotal();
        }
      });
      
      alert(`IDã€Œ${shareId}ã€ã§åŒæœŸã‚’é–‹å§‹ã—ã¾ã—ãŸï¼\nåŒã˜IDã‚’å…¥åŠ›ã—ãŸäººã¨æ—…è¡Œãƒ—ãƒ©ãƒ³ãŒå…±æœ‰ã•ã‚Œã¾ã™ã€‚`);
    });

    document.getElementById('btn-clear-data').addEventListener('click', () => {
      if (confirm('å…¥åŠ›ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’å…¨ã¦æ¶ˆå»ã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆâ€»åŒæœŸä¸­ã®å ´åˆã€å…±æœ‰å…ˆã®ãƒ‡ãƒ¼ã‚¿ã‚‚æ¶ˆå»ã•ã‚Œã¾ã™ï¼‰')) {
        allInputs.forEach(input => {
          if (input.type === 'checkbox') {
            input.checked = false;
          } else {
            input.value = '';
          }
          localStorage.removeItem(input.id);
        });
        calculateTotal();

        if (isSyncing && currentSyncId) {
          const tripRef = ref(db, 'trips/' + currentSyncId);
          remove(tripRef);
        }
        
        window.scrollTo(0, 0);
      }
    });
  </script>
</body>
</html>